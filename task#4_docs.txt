
Task#4

1. Технологии (условия)

Группа: PHP, Symfony, MySQL или PostgreSQL.

писать «голый» PHP + MySQL/PostgreSQL;
либо использовать фреймворк Symfony (ПХП) плюс БД.
В любом случае:
обязателен unique index по столбцу email в таблице пользователей;
обязателен CSS-фреймворк (рекомендуют Bootstrap, но можно любой).

2. Главные бизнес-требования
2.1. Уникальность e-mail

В таблице пользователей нужно создать уникальный индекс по полю email.
Смысл: хранилище (БД) само гарантирует, что два пользователя с одинаковым e-mail не появятся, даже если данные приходят одновременно из разных источников.
Проверка в PHP «если уже есть такой e-mail, не добавлять» – недостаточна. Индекс в БД обязателен.

2.2. Статусы пользователя
Как минимум статусы:
unverified – зарегистрировался, но почту не подтвердил;
active – подтвердил почту (по ссылке в письме) или просто активный пользователь;
blocked – заблокирован админом (любой пользователь, в т.ч. сам себя).
Дополнительно:
Заблокированный пользователь не должен иметь возможность логиниться.
Удалённый пользователь может зарегистрироваться заново с тем же e-mail.
То есть при «delete» запись реально удаляешь из таблицы, а не только помечаешь.

2.3. Регистрация и подтверждение e-mail
Пользователь регистрируется через форму.
Пароль может быть любой непустой (даже 1 символ).
Сразу после регистрации выводится сообщение о том, что регистрация успешна.
Отправляется подтверждающее письмо с ссылкой вида, например:

https://your-app/verify?token=...
Письмо должно отправляться асинхронно (из условия). На практике можешь:
либо складывать письмо в «очередь» (таблица outbox) и отправлять кроном;
либо запускать отдельный скрипт через exec/proc_open;
либо просто сделать отдельный endpoint и вызвать его без ожидания результата (для теста).

При переходе по ссылке:
находишь по token пользователя;
если он unverified, меняешь статус на active;
если blocked, статус остаётся blocked (письмо не «разблокирует»).

При этом по заданию:
пользователь может логиниться и управлять другими даже с не подтверждённым e-mail – статус unverified не запрещает логин, запрещает только отсутствие записи / блокировка.

3. Аутентификация и доступы
3.1. Кто такие «админы»
Все пользователи – админы. У всех одинаковые права.
Каждый пользователь может:
блокировать / разблокировать / удалять себя;
блокировать / разблокировать / удалять других пользователей.

3.2. Доступы к страницам
Неавторизованный пользователь:
имеет доступ только к:
форме логина;
форме регистрации.
он не должен видеть таблицу пользователей (админ-панель).
Авторизованный и не заблокированный пользователь:
имеет доступ к таблице управления пользователями.
Перед каждым запросом, кроме:
регистрации,
логина,
– сервер должен проверять:
есть ли пользователь в сессии / токене;
существует ли он в БД;
его статус не blocked.
Если пользователь заблокирован или удалён (запись не найдена):
любая его попытка доступа должна редиректить на страницу логина.

4. Таблица пользователей (admin-панель)

Требования к таблице:
Таблица должна выглядеть как таблица, а не как Excel-скриншот.
В первом JPG показано: Excel-таблица и под ней примеры неправильных форм – это «как не надо».
Последняя картинка – пример правильной таблицы с тулбаром.
Колонки (минимум):

[checkbox выбора] – слева, первая колонка.
Name.
E-mail.
Status (unverified / active / blocked).
Last login time (или последний «activity time»).

Дополнительно можно:
Registration time.
«Sparklines» активности – это необязательно, просто пример на картинке.
Данные в таблице должны быть отсортированы (например, по last_login убыванию).
В шапке таблицы:
один чекбокс без текста – «выбрать / снять выбор со всех».
Никаких кнопок в строках таблицы.
Нельзя делать отдельные кнопки «Block» / «Delete» в каждой строке.
Если сделаешь N комплектов кнопок (каждой строке свой набор) – оценку уменьшат на 20%.
Toolbar (панель действий) над таблицей:

Кнопки:
Block (текстовая кнопка).
Unblock (иконка).
Delete (иконка).
Delete unverified (иконка).
Toolbar всегда виден; можно лишь менять disabled / enabled в зависимости от того, выбраны ли пользователи.
Пример внешнего вида (из второй картинки):
Слева – кнопки тулбара.
Справа – поле Filter (можно добавить поиск по имени/e-mail).

В строках:
чекбокс,
имя,
e-mail,
статус (цветные бейджи),
last seen.

5. Поведение операций (Block / Unblock / Delete / Delete unverified)
Работают над множественным выбором:
Пользователь отмечает чекбоксами одну или несколько строк.
Нажимает кнопку в тулбаре.
Сервер выполняет операцию над всеми выбранными пользователями.

5.1. Block
Меняет статус выбранных пользователей на blocked.
Если текущий авторизованный пользователь попал в этот список:
после операции при следующем запросе (в идеале сразу) его надо выкинуть на страницу логина.
В задании отдельно говорят: продемонстрировать «all user blocking (with automatic redirection to the login page)».

5.2. Unblock
Меняет статус с blocked на:
active (или unverified? – логичнее active).
После этого пользователь может логиниться и работать.

5.3. Delete
Удаляет выбранные записи из таблицы пользователей.
В условии подчёркнуто: «Deleted users should be deleted, not ‘marked’».
То есть это DELETE FROM users WHERE id IN (...), без флагов.

5.4. Delete unverified
Удаляет только тех из выбранных, у кого статус unverified.

6. Логин и last login
Форма логина – обычная:
e-mail;
пароль;
кнопка Sign in.
При успешном логине:
записываешь last_login_at = NOW() для этого пользователя;
кладёшь его id в сессию/токен;
редирект на страницу с таблицей пользователей.

При неуспехе:
корректное сообщение об ошибке;
не использовать alert().

7. UI/UX и внешний вид
Что НЕЛЬЗЯ:
Никаких «обоев» и фоновых картинок под таблицей (как синие треугольники).

Никаких анимаций.
Никаких браузерных alert() и confirm().
Никаких Excel-подобных таблиц или странных форм без нормального выравнивания.
Что ОБЯЗАТЕЛЬНО:
Использовать CSS-фреймворк (Bootstrap и т.п.).
Нормальное выравнивание текста и элементов в ячейках (как на примере таблицы).
Адекватные сообщения об ошибках (валидация, авторизация, и т.д.).
Tooltips, где нужно (например, пояснение иконок в тулбаре).
Status messages – «flash-сообщения» по результатам операций:
«3 users have been blocked»;
«User deleted successfully» и т.п.

8. Дополнительные технические детали
Можно использовать любые библиотеки для отправки e-mail (например, PHPMailer, Symfony Mailer и т.п.), даже свою Gmail-учётку – только для теста это нормально.
Важно понимать разницу между primary key и unique index (в таблице должен быть и PK, и уникальный индекс по email).
Приложение должно корректно работать:
в любом современном браузере;
на разных разрешениях (desktop/mobile) – это уже на стороне выбранного CSS-фреймворка.

9. Что нужно сдать
Нужно отправить на p.lebedev@itransition.com:
ФИО.
Ссылку на исходники в публичном репозитории (GitHub, GitLab и т.п.).
Ссылку на задеплоенный проект (любой хостинг – Amazon, Azure, Render, Vercel, Netlify и т.п.; важно, чтобы был доступ по HTTPS/HTTP).
Записанное видео без озвучки, где показано:
регистрация;
подтверждение (переход по ссылке из письма);
логин;
выбор не текущего пользователя;
блокировка пользователя (видно, что статус изменился);
разблокировка;
выбор всех пользователей (включая текущего);
блокировка всех (должен быть автоматический редирект на страницу логина);
демонстрация созданного индекса в базе (в админке БД или через SQL).

Срок – до среды 03.12.25.